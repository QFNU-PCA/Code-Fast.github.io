<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>Python3 错误和异常</title>
</head>
<body>
<div class="article-intro" id="content">
			
			<h1>Python3 错误和异常</h1>&#13;
<p>作为 Python 初学者，在刚学习 Python 编程时，经常会看到一些报错信息，在前面我们没有提及，这章节我们会专门介绍。</p>&#13;
<p>Python 有两种错误很容易辨认：语法错误和异常。</p>&#13;
<p>Python assert（断言）用于判断一个表达式，在表达式条件为 false 的时候触发异常。</p>&#13;
<p><img decoding="async" src="https://static.jyshare.com/images/mix/assets-py.webp"/></p>&#13;
<h2>语法错误</h2>&#13;
<p>Python 的语法错误或者称之为解析错，是初学者经常碰到的，如下实例</p>&#13;
<div class="example"> &#13;
<div class="example_code">&#13;

<span style="color: Gray;">&gt;&gt;&gt;</span> <span style="color: Green;font-weight:bold;">while</span> <span style="color: Teal;">True</span> <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span><span style="color: #a11;">'Hello world'</span><span style="color: Olive;">)</span><br/>
  File <span style="color: #a11;">"&lt;stdin&gt;"</span><span style="color: Gray;">,</span> line <span style="color: Maroon;">1</span><span style="color: Gray;">,</span> <span style="color: Green;font-weight:bold;">in</span> ?<br/>
    <span style="color: Green;font-weight:bold;">while</span> <span style="color: Teal;">True</span> <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span><span style="color: #a11;">'Hello world'</span><span style="color: Olive;">)</span><br/>
                   ^<br/>
<span style="color: Teal;">SyntaxError</span>: invalid syntax<br/>
&#13;
</div></div>&#13;
<p>这个例子中，函数 print() 被检查到有错误，是它前面缺少了一个冒号 <span class="marked">:</span> 。</p><p>&#13;
语法分析器指出了出错的一行，并且在最先找到的错误的位置标记了一个小小的箭头。</p>&#13;
<h2>异常</h2>&#13;
<p>即便 Python 程序的语法是正确的，在运行它的时候，也有可能发生错误。运行期检测到的错误被称为异常。</p>&#13;
<p>大多数的异常都不会被程序处理，都以错误信息的形式展现在这里:</p>&#13;
&#13;
<div class="example">&#13;
<h2 class="example">实例</h2> &#13;
<div class="example_code">&#13;

<span style="color: Gray;">&gt;&gt;&gt;</span> <span style="color: Maroon;">10</span> * <span style="color: Olive;">(</span><span style="color: Maroon;">1</span>/<span style="color: Maroon;">0</span><span style="color: Olive;">)</span>             <span style="color: #a50"># 0 不能作为除数，触发异常</span><br/>
Traceback <span style="color: Olive;">(</span>most recent call last<span style="color: Olive;">)</span>:<br/>
  File <span style="color: #a11;">"&lt;stdin&gt;"</span><span style="color: Gray;">,</span> line <span style="color: Maroon;">1</span><span style="color: Gray;">,</span> <span style="color: Green;font-weight:bold;">in</span> ?<br/>
<span style="color: Teal;">ZeroDivisionError</span>: division by zero<br/>
<span style="color: Gray;">&gt;&gt;&gt;</span> <span style="color: Maroon;">4</span> + spam*<span style="color: Maroon;">3</span>             <span style="color: #a50"># spam 未定义，触发异常</span><br/>
Traceback <span style="color: Olive;">(</span>most recent call last<span style="color: Olive;">)</span>:<br/>
  File <span style="color: #a11;">"&lt;stdin&gt;"</span><span style="color: Gray;">,</span> line <span style="color: Maroon;">1</span><span style="color: Gray;">,</span> <span style="color: Green;font-weight:bold;">in</span> ?<br/>
<span style="color: Teal;">NameError</span>: name <span style="color: #a11;">'spam'</span> <span style="color: Green;font-weight:bold;">is</span> <span style="color: Green;font-weight:bold;">not</span> defined<br/>
<span style="color: Gray;">&gt;&gt;&gt;</span> <span style="color: #a11;">'2'</span> + <span style="color: Maroon;">2</span>               <span style="color: #a50"># int 不能与 str 相加，触发异常</span><br/>
Traceback <span style="color: Olive;">(</span>most recent call last<span style="color: Olive;">)</span>:<br/>
  File <span style="color: #a11;">"&lt;stdin&gt;"</span><span style="color: Gray;">,</span> line <span style="color: Maroon;">1</span><span style="color: Gray;">,</span> <span style="color: Green;font-weight:bold;">in</span> <span style="color: Gray;">&lt;</span>module<span style="color: Gray;">&gt;</span><br/>
<span style="color: Teal;">TypeError</span>: can only concatenate <span style="color: Teal;">str</span> <span style="color: Olive;">(</span><span style="color: Green;font-weight:bold;">not</span> <span style="color: #a11;">"int"</span><span style="color: Olive;">)</span> to <span style="color: Teal;">str</span><br/>
&#13;
</div></div>&#13;
&#13;
<p>异常以不同的类型出现，这些类型都作为信息的一部分打印出来: 例子中的类型有 ZeroDivisionError，NameError 和 TypeError。&#13;
</p>&#13;
<p>错误信息的前面部分显示了异常发生的上下文，并以调用栈的形式显示具体信息。&#13;
</p>&#13;
<h2>异常处理</h2>&#13;
<h3>try/except</h3>&#13;
<p>异常捕捉可以使用 <span class="marked">try/except</span> 语句。</p>&#13;
<p><img decoding="async" src="https://www.runoob.com/wp-content/uploads/2019/07/try_except.png"/></p>&#13;
&#13;
<p>以下例子中，让用户输入一个合法的整数，但是允许用户中断这个程序（使用 Control-C 或者操作系统提供的方法）。用户中断的信息会引发一个 KeyboardInterrupt 异常。&#13;
</p>&#13;
<div class="example"> &#13;
<div class="example_code">&#13;

<span style="color: Green;font-weight:bold;">while</span> <span style="color: Teal;">True</span>:<br/>
    <span style="color: Green;font-weight:bold;">try</span>:<br/>
        x <span style="color: Gray;">=</span> <span style="color: Teal;">int</span><span style="color: Olive;">(</span><span style="color: Teal;">input</span><span style="color: Olive;">(</span><span style="color: #a11;">"请输入一个数字: "</span><span style="color: Olive;">)</span><span style="color: Olive;">)</span><br/>
        <span style="color: Green;font-weight:bold;">break</span><br/>
    <span style="color: Green;font-weight:bold;">except</span> <span style="color: Teal;">ValueError</span>:<br/>
        <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span><span style="color: #a11;">"您输入的不是数字，请再次尝试输入！"</span><span style="color: Olive;">)</span> <br/>
&#13;
</div></div>&#13;
<p>try 语句按照如下方式工作；</p>&#13;
<ul>&#13;
<li><p>首先，执行 try 子句（在关键字 try 和关键字 except 之间的语句）。</p></li>&#13;
<li><p>如果没有异常发生，忽略 except 子句，try 子句执行后结束。</p></li>&#13;
<li><p>如果在执行 try 子句的过程中发生了异常，那么 try 子句余下的部分将被忽略。如果异常的类型和 except 之后的名称相符，那么对应的 except 子句将被执行。</p></li>&#13;
<li><p>如果一个异常没有与任何的 except  匹配，那么这个异常将会传递给上层的 try 中。</p></li>&#13;
&#13;
</ul>&#13;
<p>一个 try 语句可能包含多个except子句，分别来处理不同的特定的异常。最多只有一个分支会被执行。</p>&#13;
<p>处理程序将只针对对应的 try 子句中的异常进行处理，而不是其他的 try 的处理程序中的异常。</p><p>一个except子句可以同时处理多个异常，这些异常将被放在一个括号里成为一个元组，例如:&#13;
</p>&#13;
<div class="example"> &#13;
<div class="example_code">&#13;

<span style="color: Green;font-weight:bold;">except</span> <span style="color: Olive;">(</span><span style="color: Teal;">RuntimeError</span><span style="color: Gray;">,</span> <span style="color: Teal;">TypeError</span><span style="color: Gray;">,</span> <span style="color: Teal;">NameError</span><span style="color: Olive;">)</span>:<br/>
    <span style="color: Green;font-weight:bold;">pass</span><br/>
&#13;
</div></div>&#13;
<p>最后一个except子句可以忽略异常的名称，它将被当作通配符使用。你可以使用这种方法打印一个错误信息，然后再次把异常抛出。</p>&#13;
<div class="example"> &#13;
<div class="example_code">&#13;

<span style="color: Green;font-weight:bold;">import</span> <span style="color: #05a;">sys</span><br/>
<br/>
<span style="color: Green;font-weight:bold;">try</span>:<br/>
    f <span style="color: Gray;">=</span> <span style="color: Teal;">open</span><span style="color: Olive;">(</span><span style="color: #a11;">'myfile.txt'</span><span style="color: Olive;">)</span><br/>
    s <span style="color: Gray;">=</span> f.<span style="color: #05a;">readline</span><span style="color: Olive;">(</span><span style="color: Olive;">)</span><br/>
    i <span style="color: Gray;">=</span> <span style="color: Teal;">int</span><span style="color: Olive;">(</span>s.<span style="color: #05a;">strip</span><span style="color: Olive;">(</span><span style="color: Olive;">)</span><span style="color: Olive;">)</span><br/>
<span style="color: Green;font-weight:bold;">except</span> <span style="color: Teal;">OSError</span> <span style="color: Green;font-weight:bold;">as</span> err:<br/>
    <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span><span style="color: #a11;">"OS error: {0}"</span>.<span style="color: #05a;">format</span><span style="color: Olive;">(</span>err<span style="color: Olive;">)</span><span style="color: Olive;">)</span><br/>
<span style="color: Green;font-weight:bold;">except</span> <span style="color: Teal;">ValueError</span>:<br/>
    <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span><span style="color: #a11;">"Could not convert data to an integer."</span><span style="color: Olive;">)</span><br/>
<span style="color: Green;font-weight:bold;">except</span>:<br/>
    <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span><span style="color: #a11;">"Unexpected error:"</span><span style="color: Gray;">,</span> <span style="color: #05a;">sys</span>.<span style="color: #05a;">exc_info</span><span style="color: Olive;">(</span><span style="color: Olive;">)</span><span style="color: Olive;">[</span><span style="color: Maroon;">0</span><span style="color: Olive;">]</span><span style="color: Olive;">)</span><br/>
    <span style="color: Green;font-weight:bold;">raise</span><br/>
&#13;
</div></div>&#13;
<h3>try/except...else</h3>&#13;
<p><span class="marked">try/except</span> 语句还有一个可选的 <strong>else</strong> 子句，如果使用这个子句，那么必须放在所有的 except 子句之后。&#13;
</p><p>&#13;
else 子句将在 try 子句没有发生任何异常的时候执行。</p>&#13;
<p><img decoding="async" src="https://www.runoob.com/wp-content/uploads/2019/07/try_except_else.png"/></p>&#13;
<p>以下实例在 try 语句中判断文件是否可以打开，如果打开文件时正常的没有发生异常则执行 else 部分的语句，读取文件内容：&#13;
</p>&#13;
<div class="example"> &#13;
<div class="example_code">&#13;

<span style="color: Green;font-weight:bold;">for</span> arg <span style="color: Green;font-weight:bold;">in</span> <span style="color: #05a;">sys</span>.<span style="color: #05a;">argv</span><span style="color: Olive;">[</span><span style="color: Maroon;">1</span>:<span style="color: Olive;">]</span>:<br/>
    <span style="color: Green;font-weight:bold;">try</span>:<br/>
        f <span style="color: Gray;">=</span> <span style="color: Teal;">open</span><span style="color: Olive;">(</span>arg<span style="color: Gray;">,</span> <span style="color: #a11;">'r'</span><span style="color: Olive;">)</span><br/>
    <span style="color: Green;font-weight:bold;">except</span> <span style="color: Teal;">IOError</span>:<br/>
        <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span><span style="color: #a11;">'cannot open'</span><span style="color: Gray;">,</span> arg<span style="color: Olive;">)</span><br/>
    <span style="color: Green;font-weight:bold;">else</span>:<br/>
        <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span>arg<span style="color: Gray;">,</span> <span style="color: #a11;">'has'</span><span style="color: Gray;">,</span> <span style="color: Teal;">len</span><span style="color: Olive;">(</span>f.<span style="color: #05a;">readlines</span><span style="color: Olive;">(</span><span style="color: Olive;">)</span><span style="color: Olive;">)</span><span style="color: Gray;">,</span> <span style="color: #a11;">'lines'</span><span style="color: Olive;">)</span><br/>
        f.<span style="color: #05a;">close</span><span style="color: Olive;">(</span><span style="color: Olive;">)</span><br/>
&#13;
</div></div>&#13;
<p>使用 else 子句比把所有的语句都放在 try 子句里面要好，这样可以避免一些意想不到，而 except 又无法捕获的异常。</p>&#13;
<p>异常处理并不仅仅处理那些直接发生在 try 子句中的异常，而且还能处理子句中调用的函数（甚至间接调用的函数）里抛出的异常。例如:</p>&#13;
<div class="example"> &#13;
<div class="example_code">&#13;

<span style="color: Gray;">&gt;&gt;&gt;</span> <span style="color: Green;font-weight:bold;">def</span> this_fails<span style="color: Olive;">(</span><span style="color: Olive;">)</span>:<br/>
        x <span style="color: Gray;">=</span> <span style="color: Maroon;">1</span>/<span style="color: Maroon;">0</span><br/>
   <br/>
<span style="color: Gray;">&gt;&gt;&gt;</span> <span style="color: Green;font-weight:bold;">try</span>:<br/>
        this_fails<span style="color: Olive;">(</span><span style="color: Olive;">)</span><br/>
    <span style="color: Green;font-weight:bold;">except</span> <span style="color: Teal;">ZeroDivisionError</span> <span style="color: Green;font-weight:bold;">as</span> err:<br/>
        <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span><span style="color: #a11;">'Handling run-time error:'</span><span style="color: Gray;">,</span> err<span style="color: Olive;">)</span><br/>
   <br/>
Handling run-<span style="color: #05a;">time</span> error: <span style="color: Teal;">int</span> division <span style="color: Green;font-weight:bold;">or</span> modulo by zero<br/>
&#13;
</div></div>&#13;
&#13;
<h3>try-finally 语句</h3>&#13;
<p>try-finally 语句无论是否发生异常都将执行最后的代码。</p>&#13;
<p><img decoding="async" src="https://www.runoob.com/wp-content/uploads/2019/07/try_except_else_finally.png"/></p>&#13;
<p>以下实例中 finally 语句无论异常是否发生都会执行：</p>&#13;
<div class="example"><h2 class="example">实例</h2> <div class="example_code">
<span style="color: Green;font-weight:bold;">try</span>:<br/>
    runoob<span style="color: Olive;">(</span><span style="color: Olive;">)</span><br/>
<span style="color: Green;font-weight:bold;">except</span> <span style="color: Teal;">AssertionError</span> <span style="color: Green;font-weight:bold;">as</span> error:<br/>
    <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span>error<span style="color: Olive;">)</span><br/>
<span style="color: Green;font-weight:bold;">else</span>:<br/>
    <span style="color: Green;font-weight:bold;">try</span>:<br/>
        <span style="color: Green;font-weight:bold;">with</span> <span style="color: Teal;">open</span><span style="color: Olive;">(</span><span style="color: #a11;">'file.log'</span><span style="color: Olive;">)</span> <span style="color: Green;font-weight:bold;">as</span> <span style="color: Teal;">file</span>:<br/>
            read_data <span style="color: Gray;">=</span> <span style="color: Teal;">file</span>.<span style="color: #05a;">read</span><span style="color: Olive;">(</span><span style="color: Olive;">)</span><br/>
    <span style="color: Green;font-weight:bold;">except</span> FileNotFoundError <span style="color: Green;font-weight:bold;">as</span> fnf_error:<br/>
        <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span>fnf_error<span style="color: Olive;">)</span><br/>
<span style="color: Green;font-weight:bold;">finally</span>:<br/>
    <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span><span style="color: #a11;">'这句话，无论异常是否发生都会执行。'</span><span style="color: Olive;">)</span><br/>
</div></div>&#13;
&#13;
<hr/>&#13;
<h2>抛出异常</h2>&#13;
<p>&#13;
Python 使用 raise 语句抛出一个指定的异常。&#13;
&#13;
</p><p>raise语法格式如下：</p>&#13;
&#13;
<pre>raise [Exception [, args [, traceback]]]</pre>&#13;
&#13;
<p><img decoding="async" src="https://www.runoob.com/wp-content/uploads/2019/07/raise.png"/></p>&#13;
<p>&#13;
以下实例如果 x 大于 5 就触发异常:</p>&#13;
<div class="example"> &#13;
<div class="example_code">&#13;

x <span style="color: Gray;">=</span> <span style="color: Maroon;">10</span><br/>
<span style="color: Green;font-weight:bold;">if</span> x <span style="color: Gray;">&gt;</span> <span style="color: Maroon;">5</span>:<br/>
    <span style="color: Green;font-weight:bold;">raise</span> <span style="color: Teal;">Exception</span><span style="color: Olive;">(</span><span style="color: #a11;">'x 不能大于 5。x 的值为: {}'</span>.<span style="color: #05a;">format</span><span style="color: Olive;">(</span>x<span style="color: Olive;">)</span><span style="color: Olive;">)</span><br/>
&#13;
</div></div>&#13;
<p>执行以上代码会触发异常：</p>&#13;
<pre>Traceback (most recent call last):&#13;
  File "test.py", line 3, in &lt;module&gt;&#13;
    raise Exception('x 不能大于 5。x 的值为: {}'.format(x))&#13;
Exception: x 不能大于 5。x 的值为: 10</pre>&#13;
<p>raise 唯一的一个参数指定了要被抛出的异常。它必须是一个异常的实例或者是异常的类（也就是 Exception 的子类）。</p>&#13;
<p>如果你只想知道这是否抛出了一个异常，并不想去处理它，那么一个简单的 raise 语句就可以再次把它抛出。</p>&#13;
<div class="example"> &#13;
<div class="example_code">&#13;

<span style="color: Gray;">&gt;&gt;&gt;</span> <span style="color: Green;font-weight:bold;">try</span>:<br/>
        <span style="color: Green;font-weight:bold;">raise</span> <span style="color: Teal;">NameError</span><span style="color: Olive;">(</span><span style="color: #a11;">'HiThere'</span><span style="color: Olive;">)</span>  <span style="color: #a50"># 模拟一个异常。</span><br/>
    <span style="color: Green;font-weight:bold;">except</span> <span style="color: Teal;">NameError</span>:<br/>
        <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span><span style="color: #a11;">'An exception flew by!'</span><span style="color: Olive;">)</span><br/>
        <span style="color: Green;font-weight:bold;">raise</span><br/>
   <br/>
An exception flew by<span style="color: Gray;">!</span><br/>
Traceback <span style="color: Olive;">(</span>most recent call last<span style="color: Olive;">)</span>:<br/>
  File <span style="color: #a11;">"&lt;stdin&gt;"</span><span style="color: Gray;">,</span> line <span style="color: Maroon;">2</span><span style="color: Gray;">,</span> <span style="color: Green;font-weight:bold;">in</span> ?<br/>
<span style="color: Teal;">NameError</span>: HiThere<br/>
&#13;
</div></div>&#13;
<hr/>&#13;
<h2>用户自定义异常</h2>&#13;
<p>你可以通过创建一个新的异常类来拥有自己的异常。异常类继承自 Exception 类，可以直接继承，或者间接继承，例如:</p>&#13;
<div class="example"> &#13;
<div class="example_code">&#13;

<span style="color: Gray;">&gt;&gt;&gt;</span> <span style="color: Green;font-weight:bold;">class</span> MyError<span style="color: Olive;">(</span><span style="color: Teal;">Exception</span><span style="color: Olive;">)</span>:<br/>
        <span style="color: Green;font-weight:bold;">def</span> <span style="color: Navy;">__init__</span><span style="color: Olive;">(</span><span style="color: Teal;">self</span><span style="color: Gray;">,</span> value<span style="color: Olive;">)</span>:<br/>
            <span style="color: Teal;">self</span>.<span style="color: #05a;">value</span> <span style="color: Gray;">=</span> value<br/>
        <span style="color: Green;font-weight:bold;">def</span> <span style="color: Navy;">__str__</span><span style="color: Olive;">(</span><span style="color: Teal;">self</span><span style="color: Olive;">)</span>:<br/>
            <span style="color: Green;font-weight:bold;">return</span> <span style="color: #05a;">repr</span><span style="color: Olive;">(</span><span style="color: Teal;">self</span>.<span style="color: #05a;">value</span><span style="color: Olive;">)</span><br/>
   <br/>
<span style="color: Gray;">&gt;&gt;&gt;</span> <span style="color: Green;font-weight:bold;">try</span>:<br/>
        <span style="color: Green;font-weight:bold;">raise</span> MyError<span style="color: Olive;">(</span><span style="color: Maroon;">2</span>*<span style="color: Maroon;">2</span><span style="color: Olive;">)</span><br/>
    <span style="color: Green;font-weight:bold;">except</span> MyError <span style="color: Green;font-weight:bold;">as</span> e:<br/>
        <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span><span style="color: #a11;">'My exception occurred, value:'</span><span style="color: Gray;">,</span> e.<span style="color: #05a;">value</span><span style="color: Olive;">)</span><br/>
   <br/>
My exception occurred<span style="color: Gray;">,</span> value: <span style="color: Maroon;">4</span><br/>
<span style="color: Gray;">&gt;&gt;&gt;</span> <span style="color: Green;font-weight:bold;">raise</span> MyError<span style="color: Olive;">(</span><span style="color: #a11;">'oops!'</span><span style="color: Olive;">)</span><br/>
Traceback <span style="color: Olive;">(</span>most recent call last<span style="color: Olive;">)</span>:<br/>
  File <span style="color: #a11;">"&lt;stdin&gt;"</span><span style="color: Gray;">,</span> line <span style="color: Maroon;">1</span><span style="color: Gray;">,</span> <span style="color: Green;font-weight:bold;">in</span> ?<br/>
<span style="color: #05a;">__main__</span>.<span style="color: #05a;">MyError</span>: <span style="color: #a11;">'oops!'</span><br/>
&#13;
</div></div>&#13;
<p>在这个例子中，类 Exception 默认的 __init__() 被覆盖。</p>&#13;
<p>&#13;
</p><p>当创建一个模块有可能抛出多种不同的异常时，一种通常的做法是为这个包建立一个基础异常类，然后基于这个基础类为不同的错误情况创建不同的子类:</p>&#13;
<div class="example"> &#13;
<div class="example_code">&#13;

<span style="color: Green;font-weight:bold;">class</span> Error<span style="color: Olive;">(</span><span style="color: Teal;">Exception</span><span style="color: Olive;">)</span>:<br/>
    <span style="color: #a11;">"""Base class for exceptions in this module."""</span><br/>
    <span style="color: Green;font-weight:bold;">pass</span><br/>
<br/>
<span style="color: Green;font-weight:bold;">class</span> InputError<span style="color: Olive;">(</span>Error<span style="color: Olive;">)</span>:<br/>
    <span style="color: #a11;">"""Exception raised for errors in the input.<br/>
<br/>
    Attributes:<br/>
        expression -- input expression in which the error occurred<br/>
        message -- explanation of the error<br/>
    """</span><br/>
<br/>
    <span style="color: Green;font-weight:bold;">def</span> <span style="color: Navy;">__init__</span><span style="color: Olive;">(</span><span style="color: Teal;">self</span><span style="color: Gray;">,</span> expression<span style="color: Gray;">,</span> message<span style="color: Olive;">)</span>:<br/>
        <span style="color: Teal;">self</span>.<span style="color: #05a;">expression</span> <span style="color: Gray;">=</span> expression<br/>
        <span style="color: Teal;">self</span>.<span style="color: #05a;">message</span> <span style="color: Gray;">=</span> message<br/>
<br/>
<span style="color: Green;font-weight:bold;">class</span> TransitionError<span style="color: Olive;">(</span>Error<span style="color: Olive;">)</span>:<br/>
    <span style="color: #a11;">"""Raised when an operation attempts a state transition that's not<br/>
    allowed.<br/>
<br/>
    Attributes:<br/>
        previous -- state at beginning of transition<br/>
        next -- attempted new state<br/>
        message -- explanation of why the specific transition is not allowed<br/>
    """</span><br/>
<br/>
    <span style="color: Green;font-weight:bold;">def</span> <span style="color: Navy;">__init__</span><span style="color: Olive;">(</span><span style="color: Teal;">self</span><span style="color: Gray;">,</span> previous<span style="color: Gray;">,</span> next<span style="color: Gray;">,</span> message<span style="color: Olive;">)</span>:<br/>
        <span style="color: Teal;">self</span>.<span style="color: #05a;">previous</span> <span style="color: Gray;">=</span> previous<br/>
        <span style="color: Teal;">self</span>.<span style="color: #05a;">next</span> <span style="color: Gray;">=</span> next<br/>
        <span style="color: Teal;">self</span>.<span style="color: #05a;">message</span> <span style="color: Gray;">=</span> message<br/>
&#13;
</div></div>&#13;
<p>大多数的异常的名字都以"Error"结尾，就跟标准的异常命名一样。</p>&#13;
<hr/>&#13;
<h2>定义清理行为</h2>&#13;
<p>try 语句还有另外一个可选的子句，它定义了无论在任何情况下都会执行的清理行为。 例如:</p>&#13;
<div class="example"> &#13;
<div class="example_code">&#13;

<span style="color: Gray;">&gt;&gt;&gt;</span> <span style="color: Green;font-weight:bold;">try</span>:<br/>
...     <span style="color: Green;font-weight:bold;">raise</span> <span style="color: Teal;">KeyboardInterrupt</span><br/>
... <span style="color: Green;font-weight:bold;">finally</span>:<br/>
...     <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span><span style="color: #a11;">'Goodbye, world!'</span><span style="color: Olive;">)</span><br/>
... <br/>
<span style="color: #05a;">Goodbye</span><span style="color: Gray;">,</span> world<span style="color: Gray;">!</span><br/>
Traceback <span style="color: Olive;">(</span>most recent call last<span style="color: Olive;">)</span>:<br/>
  File <span style="color: #a11;">"&lt;stdin&gt;"</span><span style="color: Gray;">,</span> line <span style="color: Maroon;">2</span><span style="color: Gray;">,</span> <span style="color: Green;font-weight:bold;">in</span> <span style="color: Gray;">&lt;</span>module<span style="color: Gray;">&gt;</span><br/>
<span style="color: Teal;">KeyboardInterrupt</span><br/>
&#13;
</div></div>&#13;
<p>以上例子不管 try 子句里面有没有发生异常，finally 子句都会执行。</p>&#13;
<p>如果一个异常在 try 子句里（或者在 except 和 else 子句里）被抛出，而又没有任何的 except 把它截住，那么这个异常会在 finally 子句执行后被抛出。</p>&#13;
<p>下面是一个更加复杂的例子（在同一个 try 语句里包含 except 和 finally 子句）:</p>&#13;
<div class="example"> &#13;
<div class="example_code">&#13;

<span style="color: Gray;">&gt;&gt;&gt;</span> <span style="color: Green;font-weight:bold;">def</span> divide<span style="color: Olive;">(</span>x<span style="color: Gray;">,</span> y<span style="color: Olive;">)</span>:<br/>
        <span style="color: Green;font-weight:bold;">try</span>:<br/>
            result <span style="color: Gray;">=</span> x / y<br/>
        <span style="color: Green;font-weight:bold;">except</span> <span style="color: Teal;">ZeroDivisionError</span>:<br/>
            <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span><span style="color: #a11;">"division by zero!"</span><span style="color: Olive;">)</span><br/>
        <span style="color: Green;font-weight:bold;">else</span>:<br/>
            <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span><span style="color: #a11;">"result is"</span><span style="color: Gray;">,</span> result<span style="color: Olive;">)</span><br/>
        <span style="color: Green;font-weight:bold;">finally</span>:<br/>
            <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span><span style="color: #a11;">"executing finally clause"</span><span style="color: Olive;">)</span><br/>
   <br/>
<span style="color: Gray;">&gt;&gt;&gt;</span> divide<span style="color: Olive;">(</span><span style="color: Maroon;">2</span><span style="color: Gray;">,</span> <span style="color: Maroon;">1</span><span style="color: Olive;">)</span><br/>
result <span style="color: Green;font-weight:bold;">is</span> <span style="color: Maroon;">2.0</span><br/>
executing <span style="color: Green;font-weight:bold;">finally</span> clause<br/>
<span style="color: Gray;">&gt;&gt;&gt;</span> divide<span style="color: Olive;">(</span><span style="color: Maroon;">2</span><span style="color: Gray;">,</span> <span style="color: Maroon;">0</span><span style="color: Olive;">)</span><br/>
division by zero<span style="color: Gray;">!</span><br/>
executing <span style="color: Green;font-weight:bold;">finally</span> clause<br/>
<span style="color: Gray;">&gt;&gt;&gt;</span> divide<span style="color: Olive;">(</span><span style="color: #a11;">"2"</span><span style="color: Gray;">,</span> <span style="color: #a11;">"1"</span><span style="color: Olive;">)</span><br/>
executing <span style="color: Green;font-weight:bold;">finally</span> clause<br/>
Traceback <span style="color: Olive;">(</span>most recent call last<span style="color: Olive;">)</span>:<br/>
  File <span style="color: #a11;">"&lt;stdin&gt;"</span><span style="color: Gray;">,</span> line <span style="color: Maroon;">1</span><span style="color: Gray;">,</span> <span style="color: Green;font-weight:bold;">in</span> ?<br/>
  File <span style="color: #a11;">"&lt;stdin&gt;"</span><span style="color: Gray;">,</span> line <span style="color: Maroon;">3</span><span style="color: Gray;">,</span> <span style="color: Green;font-weight:bold;">in</span> divide<br/>
<span style="color: Teal;">TypeError</span>: unsupported operand <span style="color: Teal;">type</span><span style="color: Olive;">(</span>s<span style="color: Olive;">)</span> <span style="color: Green;font-weight:bold;">for</span> /: <span style="color: #a11;">'str'</span> <span style="color: Green;font-weight:bold;">and</span> <span style="color: #a11;">'str'</span><br/>
&#13;
</div></div>&#13;
<hr/>&#13;
<h2>预定义的清理行为</h2>&#13;
<p>一些对象定义了标准的清理行为，无论系统是否成功的使用了它，一旦不需要它了，那么这个标准的清理行为就会执行。</p>&#13;
<p>下面这个例子展示了尝试打开一个文件，然后把内容打印到屏幕上:&#13;
</p>&#13;
<div class="example"> &#13;
<div class="example_code">&#13;

<span style="color: Green;font-weight:bold;">for</span> line <span style="color: Green;font-weight:bold;">in</span> <span style="color: Teal;">open</span><span style="color: Olive;">(</span><span style="color: #a11;">"myfile.txt"</span><span style="color: Olive;">)</span>:<br/>
    <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span>line<span style="color: Gray;">,</span> end<span style="color: Gray;">=</span><span style="color: #a11;">""</span><span style="color: Olive;">)</span><br/>
&#13;
</div></div>&#13;
<p>以上这段代码的问题是，当执行完毕后，文件会保持打开状态，并没有被关闭。</p>&#13;
<p>关键词 with 语句就可以保证诸如文件之类的对象在使用完之后一定会正确的执行他的清理方法:</p>&#13;
<div class="example"> &#13;
<div class="example_code">&#13;

<span style="color: Green;font-weight:bold;">with</span> <span style="color: Teal;">open</span><span style="color: Olive;">(</span><span style="color: #a11;">"myfile.txt"</span><span style="color: Olive;">)</span> <span style="color: Green;font-weight:bold;">as</span> f:<br/>
    <span style="color: Green;font-weight:bold;">for</span> line <span style="color: Green;font-weight:bold;">in</span> f:<br/>
        <span style="color: Green;font-weight:bold;">print</span><span style="color: Olive;">(</span>line<span style="color: Gray;">,</span> end<span style="color: Gray;">=</span><span style="color: #a11;">""</span><span style="color: Olive;">)</span><br/>
&#13;
</div></div>&#13;
<p>以上这段代码执行完毕后，就算在处理过程中出问题了，文件 f 总是会关闭。&#13;
</p>&#13;
<p>更多 with 关键字内容参考：<a href="https://www.runoob.com/python3/python-with.html" rel="noopener" target="_blank">Python with 关键字</a></p>&#13;
<hr/>&#13;
<h2>相关内容</h2>&#13;
<p><a href="/python3/python3-assert.html" rel="noopener noreferrer" target="_blank">Python assert（断言）</a></p>&#13;
<p><a href="https://www.runoob.com/python3/python-with.html" rel="noopener" target="_blank">Python with 关键字</a></p>			<!-- 其他扩展 -->
						
			</div>
			
		
</body>
</html>