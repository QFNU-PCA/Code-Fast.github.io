<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>Python3 迭代器与生成器</title>
</head>
<body>
<div class="article-intro" id="content">
			
			<h1>Python3 迭代器与生成器</h1>&#13;
<hr/>&#13;
<h2>迭代器</h2>&#13;
<p>迭代是 Python 最强大的功能之一，是访问集合元素的一种方式。</p>&#13;
<p>迭代器是一个可以记住遍历的位置的对象。</p>&#13;
<p>迭代器对象从集合的第一个元素开始访问，直到所有的元素被访问完结束。迭代器只能往前不会后退。</p>&#13;
<p>&#13;
迭代器有两个基本的方法：<strong>iter()</strong> 和 <strong>next()</strong>。&#13;
</p>&#13;
<p>字符串，列表或元组对象都可用于创建迭代器：</p>&#13;
<div class="example"> &#13;
<h2 class="example">实例(Python 3.0+)</h2> &#13;
<div class="example_code">&#13;

<span style="color: Gray;">&gt;&gt;&gt;</span> <span style="color: Teal;">list</span><span style="color: Gray;">=</span><span style="color: Olive;">[</span><span style="color: Maroon;">1</span><span style="color: Gray;">,</span><span style="color: Maroon;">2</span><span style="color: Gray;">,</span><span style="color: Maroon;">3</span><span style="color: Gray;">,</span><span style="color: Maroon;">4</span><span style="color: Olive;">]</span><br/>
<span style="color: Gray;">&gt;&gt;&gt;</span> it <span style="color: Gray;">=</span> <span style="color: Teal;">iter</span><span style="color: Olive;">(</span><span style="color: Teal;">list</span><span style="color: Olive;">)</span>    <span style="color: #a50"># 创建迭代器对象</span><br/>
<span style="color: Gray;">&gt;&gt;&gt;</span> <span style="color: Green;font-weight:bold;">print</span> <span style="color: Olive;">(</span>next<span style="color: Olive;">(</span>it<span style="color: Olive;">)</span><span style="color: Olive;">)</span>   <span style="color: #a50"># 输出迭代器的下一个元素</span><br/>
<span style="color: Maroon;">1</span><br/>
<span style="color: Gray;">&gt;&gt;&gt;</span> <span style="color: Green;font-weight:bold;">print</span> <span style="color: Olive;">(</span>next<span style="color: Olive;">(</span>it<span style="color: Olive;">)</span><span style="color: Olive;">)</span><br/>
<span style="color: Maroon;">2</span><br/>
<span style="color: Gray;">&gt;&gt;&gt;</span> <br/>
&#13;
</div>&#13;
</div>&#13;
<p>迭代器对象可以使用常规for语句进行遍历：</p>&#13;
<div class="example"> &#13;
<h2 class="example">实例(Python 3.0+)</h2> &#13;
<div class="example_code">&#13;
<div class="hl-main"><span class="hl-comment">#!/usr/bin/python3</span><span class="hl-code">
 
</span><span class="hl-identifier">list</span><span class="hl-code">=</span><span class="hl-brackets">[</span><span class="hl-number">1</span><span class="hl-code">,</span><span class="hl-number">2</span><span class="hl-code">,</span><span class="hl-number">3</span><span class="hl-code">,</span><span class="hl-number">4</span><span class="hl-brackets">]</span><span class="hl-code">
</span><span class="hl-identifier">it</span><span class="hl-code"> = </span><span class="hl-builtin">iter</span><span class="hl-brackets">(</span><span class="hl-identifier">list</span><span class="hl-brackets">)</span><span class="hl-code">    </span><span class="hl-comment"># 创建迭代器对象</span><span class="hl-code">
</span><span class="hl-reserved">for</span><span class="hl-code"> </span><span class="hl-identifier">x</span><span class="hl-code"> </span><span class="hl-reserved">in</span><span class="hl-code"> </span><span class="hl-identifier">it</span><span class="hl-code">:
    </span><span class="hl-identifier">print</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">x</span><span class="hl-code">, </span><span class="hl-identifier">end</span><span class="hl-code">=</span><span class="hl-quotes">"</span><span class="hl-string"> </span><span class="hl-quotes">"</span><span class="hl-brackets">)</span></div>&#13;
</div>&#13;
</div>&#13;
<p>执行以上程序，输出结果如下：</p>&#13;
<pre>&#13;
1 2 3 4&#13;
</pre>&#13;
<p>也可以使用  next() 函数：</p>&#13;
<div class="example"> &#13;
<h2 class="example">实例(Python 3.0+)</h2> &#13;
<div class="example_code">&#13;
<div class="hl-main"><span class="hl-comment">#!/usr/bin/python3</span><span class="hl-code">
 
</span><span class="hl-reserved">import</span><span class="hl-code"> </span><span class="hl-identifier">sys</span><span class="hl-code">         </span><span class="hl-comment"># 引入 sys 模块</span><span class="hl-code">
 
</span><span class="hl-identifier">list</span><span class="hl-code">=</span><span class="hl-brackets">[</span><span class="hl-number">1</span><span class="hl-code">,</span><span class="hl-number">2</span><span class="hl-code">,</span><span class="hl-number">3</span><span class="hl-code">,</span><span class="hl-number">4</span><span class="hl-brackets">]</span><span class="hl-code">
</span><span class="hl-identifier">it</span><span class="hl-code"> = </span><span class="hl-builtin">iter</span><span class="hl-brackets">(</span><span class="hl-identifier">list</span><span class="hl-brackets">)</span><span class="hl-code">    </span><span class="hl-comment"># 创建迭代器对象</span><span class="hl-code">
 
</span><span class="hl-reserved">while</span><span class="hl-code"> </span><span class="hl-reserved">True</span><span class="hl-code">:
    </span><span class="hl-reserved">try</span><span class="hl-code">:
        </span><span class="hl-identifier">print</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">next</span><span class="hl-brackets">(</span><span class="hl-identifier">it</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">
    </span><span class="hl-reserved">except</span><span class="hl-code"> </span><span class="hl-reserved">StopIteration</span><span class="hl-code">:
        </span><span class="hl-identifier">sys</span><span class="hl-code">.</span><span class="hl-identifier">exit</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span></div>&#13;
</div>&#13;
</div>&#13;
<p>执行以上程序，输出结果如下：</p>&#13;
<pre>&#13;
1&#13;
2&#13;
3&#13;
4&#13;
</pre>&#13;
<h3>创建一个迭代器</h3>&#13;
<p>把一个类作为一个迭代器使用需要在类中实现两个方法 __iter__() 与 __next__() 。</p>&#13;
&#13;
<p>如果你已经了解的面向对象编程，就知道类都有一个构造函数，Python 的构造函数为 __init__(), 它会在对象初始化的时候执行。</p>&#13;
<p>更多内容查阅：<a href="/python3/python3-class.html" rel="noopener noreferrer" target="_blank">Python3 面向对象</a></p>&#13;
&#13;
 <p>__iter__() 方法返回一个特殊的迭代器对象， 这个迭代器对象实现了 __next__() 方法并通过 StopIteration 异常标识迭代的完成。</p>&#13;
<p>__next__() 方法（Python 2 里是 next()）会返回下一个迭代器对象。</p>&#13;
&#13;
&#13;
<p>创建一个返回数字的迭代器，初始值为 1，逐步递增 1：</p>&#13;
&#13;
&#13;
<div class="example"> &#13;
<h2 class="example">实例(Python 3.0+)</h2> &#13;
<div class="example_code">&#13;
<div class="hl-main"><span class="hl-reserved">class</span><span class="hl-code"> </span><span class="hl-identifier">MyNumbers</span><span class="hl-code">:
  </span><span class="hl-reserved">def</span><span class="hl-code"> </span><span class="hl-identifier">__iter__</span><span class="hl-brackets">(</span><span class="hl-identifier">self</span><span class="hl-brackets">)</span><span class="hl-code">:
    </span><span class="hl-identifier">self</span><span class="hl-code">.</span><span class="hl-identifier">a</span><span class="hl-code"> = </span><span class="hl-number">1</span><span class="hl-code">
    </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">self</span><span class="hl-code">
 
  </span><span class="hl-reserved">def</span><span class="hl-code"> </span><span class="hl-identifier">__next__</span><span class="hl-brackets">(</span><span class="hl-identifier">self</span><span class="hl-brackets">)</span><span class="hl-code">:
    </span><span class="hl-identifier">x</span><span class="hl-code"> = </span><span class="hl-identifier">self</span><span class="hl-code">.</span><span class="hl-identifier">a</span><span class="hl-code">
    </span><span class="hl-identifier">self</span><span class="hl-code">.</span><span class="hl-identifier">a</span><span class="hl-code"> += </span><span class="hl-number">1</span><span class="hl-code">
    </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">x</span><span class="hl-code">
 
</span><span class="hl-identifier">myclass</span><span class="hl-code"> = </span><span class="hl-identifier">MyNumbers</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">myiter</span><span class="hl-code"> = </span><span class="hl-builtin">iter</span><span class="hl-brackets">(</span><span class="hl-identifier">myclass</span><span class="hl-brackets">)</span><span class="hl-code">
 
</span><span class="hl-identifier">print</span><span class="hl-brackets">(</span><span class="hl-identifier">next</span><span class="hl-brackets">(</span><span class="hl-identifier">myiter</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">print</span><span class="hl-brackets">(</span><span class="hl-identifier">next</span><span class="hl-brackets">(</span><span class="hl-identifier">myiter</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">print</span><span class="hl-brackets">(</span><span class="hl-identifier">next</span><span class="hl-brackets">(</span><span class="hl-identifier">myiter</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">print</span><span class="hl-brackets">(</span><span class="hl-identifier">next</span><span class="hl-brackets">(</span><span class="hl-identifier">myiter</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">print</span><span class="hl-brackets">(</span><span class="hl-identifier">next</span><span class="hl-brackets">(</span><span class="hl-identifier">myiter</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span></div>&#13;
</div>&#13;
</div>&#13;
<p>执行输出结果为：</p>&#13;
<pre>1&#13;
2&#13;
3&#13;
4&#13;
5</pre>&#13;
&#13;
<h3>StopIteration</h3>&#13;
<p>StopIteration 异常用于标识迭代的完成，防止出现无限循环的情况，在  __next__() 方法中我们可以设置在完成指定循环次数后触发 StopIteration 异常来结束迭代。</p>&#13;
&#13;
<p>在 20 次迭代后停止执行：</p>&#13;
<div class="example"> &#13;
<h2 class="example">实例(Python 3.0+)</h2> &#13;
<div class="example_code">&#13;
<div class="hl-main"><span class="hl-reserved">class</span><span class="hl-code"> </span><span class="hl-identifier">MyNumbers</span><span class="hl-code">:
  </span><span class="hl-reserved">def</span><span class="hl-code"> </span><span class="hl-identifier">__iter__</span><span class="hl-brackets">(</span><span class="hl-identifier">self</span><span class="hl-brackets">)</span><span class="hl-code">:
    </span><span class="hl-identifier">self</span><span class="hl-code">.</span><span class="hl-identifier">a</span><span class="hl-code"> = </span><span class="hl-number">1</span><span class="hl-code">
    </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">self</span><span class="hl-code">
 
  </span><span class="hl-reserved">def</span><span class="hl-code"> </span><span class="hl-identifier">__next__</span><span class="hl-brackets">(</span><span class="hl-identifier">self</span><span class="hl-brackets">)</span><span class="hl-code">:
    </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-identifier">self</span><span class="hl-code">.</span><span class="hl-identifier">a</span><span class="hl-code"> &lt;= </span><span class="hl-number">20</span><span class="hl-code">:
      </span><span class="hl-identifier">x</span><span class="hl-code"> = </span><span class="hl-identifier">self</span><span class="hl-code">.</span><span class="hl-identifier">a</span><span class="hl-code">
      </span><span class="hl-identifier">self</span><span class="hl-code">.</span><span class="hl-identifier">a</span><span class="hl-code"> += </span><span class="hl-number">1</span><span class="hl-code">
      </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">x</span><span class="hl-code">
    </span><span class="hl-reserved">else</span><span class="hl-code">:
      </span><span class="hl-reserved">raise</span><span class="hl-code"> </span><span class="hl-reserved">StopIteration</span><span class="hl-code">
 
</span><span class="hl-identifier">myclass</span><span class="hl-code"> = </span><span class="hl-identifier">MyNumbers</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">myiter</span><span class="hl-code"> = </span><span class="hl-builtin">iter</span><span class="hl-brackets">(</span><span class="hl-identifier">myclass</span><span class="hl-brackets">)</span><span class="hl-code">
 
</span><span class="hl-reserved">for</span><span class="hl-code"> </span><span class="hl-identifier">x</span><span class="hl-code"> </span><span class="hl-reserved">in</span><span class="hl-code"> </span><span class="hl-identifier">myiter</span><span class="hl-code">:
  </span><span class="hl-identifier">print</span><span class="hl-brackets">(</span><span class="hl-identifier">x</span><span class="hl-brackets">)</span></div>&#13;
</div>&#13;
</div>&#13;
<p>执行输出结果为：</p>&#13;
&#13;
<pre>1&#13;
2&#13;
3&#13;
4&#13;
5&#13;
6&#13;
7&#13;
8&#13;
9&#13;
10&#13;
11&#13;
12&#13;
13&#13;
14&#13;
15&#13;
16&#13;
17&#13;
18&#13;
19&#13;
20</pre>&#13;
<hr/>&#13;
<h2>生成器</h2><p>&#13;
</p><p>在 Python 中，使用了 <strong>yield</strong> 的函数被称为生成器（generator）。</p>&#13;
<p>&#13;
<strong>yield</strong> 是一个关键字，用于定义生成器函数，生成器函数是一种特殊的函数，可以在迭代过程中逐步产生值，而不是一次性返回所有结果。</p>&#13;
<p>跟普通函数不同的是，生成器是一个返回迭代器的函数，只能用于迭代操作，更简单点理解生成器就是一个迭代器。 </p>&#13;
<p>当在生成器函数中使用 <strong>yield</strong> 语句时，函数的执行将会暂停，并将 <strong>yield</strong> 后面的表达式作为当前迭代的值返回。</p><p>然后，每次调用生成器的 <strong>next()</strong> 方法或使用 <strong>for</strong> 循环进行迭代时，函数会从上次暂停的地方继续执行，直到再次遇到 <strong>yield</strong> 语句。这样，生成器函数可以逐步产生值，而不需要一次性计算并返回所有结果。</p>&#13;
<p>调用一个生成器函数，返回的是一个迭代器对象。</p>&#13;
&#13;
<p>下面是一个简单的示例，展示了生成器函数的使用：</p>&#13;
<div class="example"><h2 class="example">实例</h2> <div class="example_code"><div class="hl-main"><span class="hl-reserved">def</span><span class="hl-code"> </span><span class="hl-identifier">countdown</span><span class="hl-brackets">(</span><span class="hl-identifier">n</span><span class="hl-brackets">)</span><span class="hl-code">:
    </span><span class="hl-reserved">while</span><span class="hl-code"> </span><span class="hl-identifier">n</span><span class="hl-code"> &gt; </span><span class="hl-number">0</span><span class="hl-code">:
        </span><span class="hl-reserved">yield</span><span class="hl-code"> </span><span class="hl-identifier">n</span><span class="hl-code">
        </span><span class="hl-identifier">n</span><span class="hl-code"> -= </span><span class="hl-number">1</span><span class="hl-code">
 
</span><span class="hl-comment"># 创建生成器对象</span><span class="hl-code">
</span><span class="hl-identifier">generator</span><span class="hl-code"> = </span><span class="hl-identifier">countdown</span><span class="hl-brackets">(</span><span class="hl-number">5</span><span class="hl-brackets">)</span><span class="hl-code">
 
</span><span class="hl-comment"># 通过迭代生成器获取值</span><span class="hl-code">
</span><span class="hl-identifier">print</span><span class="hl-brackets">(</span><span class="hl-identifier">next</span><span class="hl-brackets">(</span><span class="hl-identifier">generator</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">  </span><span class="hl-comment"># 输出: 5</span><span class="hl-code">
</span><span class="hl-identifier">print</span><span class="hl-brackets">(</span><span class="hl-identifier">next</span><span class="hl-brackets">(</span><span class="hl-identifier">generator</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">  </span><span class="hl-comment"># 输出: 4</span><span class="hl-code">
</span><span class="hl-identifier">print</span><span class="hl-brackets">(</span><span class="hl-identifier">next</span><span class="hl-brackets">(</span><span class="hl-identifier">generator</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">  </span><span class="hl-comment"># 输出: 3</span><span class="hl-code">
 
</span><span class="hl-comment"># 使用 for 循环迭代生成器</span><span class="hl-code">
</span><span class="hl-reserved">for</span><span class="hl-code"> </span><span class="hl-identifier">value</span><span class="hl-code"> </span><span class="hl-reserved">in</span><span class="hl-code"> </span><span class="hl-identifier">generator</span><span class="hl-code">:
    </span><span class="hl-identifier">print</span><span class="hl-brackets">(</span><span class="hl-identifier">value</span><span class="hl-brackets">)</span><span class="hl-code">  </span><span class="hl-comment"># 输出: 2 1</span></div></div></div>&#13;
<p>以上实例中，<strong>countdown</strong> 函数是一个生成器函数。它使用 yield 语句逐步产生从 n 到 1 的倒数数字。在每次调用 yield 语句时，函数会返回当前的倒数值，并在下一次调用时从上次暂停的地方继续执行。</p>&#13;
<p>&#13;
通过创建生成器对象并使用 next() 函数或 for 循环迭代生成器，我们可以逐步获取生成器函数产生的值。在这个例子中，我们首先使用 next() 函数获取前三个倒数值，然后通过 for 循环获取剩下的两个倒数值。</p>&#13;
<p>&#13;
生成器函数的优势是它们可以按需生成值，避免一次性生成大量数据并占用大量内存。此外，生成器还可以与其他迭代工具（如for循环）无缝配合使用，提供简洁和高效的迭代方式。</p>&#13;
<p>执行以上程序，输出结果如下：</p>&#13;
<pre>5&#13;
4&#13;
3&#13;
2&#13;
1</pre>&#13;
<p>以下实例使用 yield 实现斐波那契数列：</p>&#13;
<div class="example"> &#13;
<h2 class="example">实例(Python 3.0+)</h2> &#13;
<div class="example_code">&#13;
<div class="hl-main"><span class="hl-comment">#!/usr/bin/python3</span><span class="hl-code">
 
</span><span class="hl-reserved">import</span><span class="hl-code"> </span><span class="hl-identifier">sys</span><span class="hl-code">
 
</span><span class="hl-reserved">def</span><span class="hl-code"> </span><span class="hl-identifier">fibonacci</span><span class="hl-brackets">(</span><span class="hl-identifier">n</span><span class="hl-brackets">)</span><span class="hl-code">: </span><span class="hl-comment"># 生成器函数 - 斐波那契</span><span class="hl-code">
    </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span class="hl-identifier">b</span><span class="hl-code">, </span><span class="hl-identifier">counter</span><span class="hl-code"> = </span><span class="hl-number">0</span><span class="hl-code">, </span><span class="hl-number">1</span><span class="hl-code">, </span><span class="hl-number">0</span><span class="hl-code">
    </span><span class="hl-reserved">while</span><span class="hl-code"> </span><span class="hl-reserved">True</span><span class="hl-code">:
        </span><span class="hl-identifier">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">counter</span><span class="hl-code"> &gt; </span><span class="hl-identifier">n</span><span class="hl-brackets">)</span><span class="hl-code">: 
            </span><span class="hl-reserved">return</span><span class="hl-code">
        </span><span class="hl-reserved">yield</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">
        </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span class="hl-identifier">b</span><span class="hl-code"> = </span><span class="hl-identifier">b</span><span class="hl-code">, </span><span class="hl-identifier">a</span><span class="hl-code"> + </span><span class="hl-identifier">b</span><span class="hl-code">
        </span><span class="hl-identifier">counter</span><span class="hl-code"> += </span><span class="hl-number">1</span><span class="hl-code">
</span><span class="hl-identifier">f</span><span class="hl-code"> = </span><span class="hl-identifier">fibonacci</span><span class="hl-brackets">(</span><span class="hl-number">10</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-comment"># f 是一个迭代器，由生成器返回生成</span><span class="hl-code">
 
</span><span class="hl-reserved">while</span><span class="hl-code"> </span><span class="hl-reserved">True</span><span class="hl-code">:
    </span><span class="hl-reserved">try</span><span class="hl-code">:
        </span><span class="hl-identifier">print</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">next</span><span class="hl-brackets">(</span><span class="hl-identifier">f</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-identifier">end</span><span class="hl-code">=</span><span class="hl-quotes">"</span><span class="hl-string"> </span><span class="hl-quotes">"</span><span class="hl-brackets">)</span><span class="hl-code">
    </span><span class="hl-reserved">except</span><span class="hl-code"> </span><span class="hl-reserved">StopIteration</span><span class="hl-code">:
        </span><span class="hl-identifier">sys</span><span class="hl-code">.</span><span class="hl-identifier">exit</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span></div>&#13;
</div>&#13;
</div><p>执行以上程序，输出结果如下：</p>&#13;
<pre>&#13;
0 1 1 2 3 5 8 13 21 34 55&#13;
</pre>			<!-- 其他扩展 -->
						
			</div>
			
		
</body>
</html>