<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>C 标准库 - <time.h></title>
</head>
<body>
<div class="article-intro" id="content">
			
			<h1>C 标准库 - <span class="color_h1">&lt;time.h&gt;</span></h1>&#13;
&#13;
<h2>简介</h2>&#13;
<p><b>time.h</b> 头文件定义了四个变量类型、两个宏和各种操作日期和时间的函数。</p>&#13;
<p><code>&lt;time.h&gt;</code> 是 C 标准库中的一个头文件，提供了处理和操作日期和时间的函数和类型。这个头文件中的函数用于获取当前时间、设置时间、格式化时间和计算时间差等。</p>&#13;
<h3>常量与宏</h3><table class="reference"><thead><tr><th>常量/宏</th><th>说明</th></tr></thead><tbody><tr><td><code>CLOCKS_PER_SEC</code></td><td>每秒的时钟周期数。</td></tr><tr><td><code>NULL</code></td><td>空指针常量。</td></tr><tr><td><code>TIME_UTC</code></td><td>表示 UTC 时间（C11）。</td></tr></tbody></table>&#13;
<h3>库变量</h3>&#13;
<p>下面是头文件 time.h 中定义的变量类型：</p>&#13;
<table class="reference">&#13;
<tr><th style="width:5%">序号</th><th>变量 &amp; 描述</th></tr>&#13;
<tr><td>1</td><td><b>size_t </b><br/>是无符号整数类型，它是 <b>sizeof</b> 关键字的结果。</td></tr>&#13;
<tr><td>2</td><td><b>clock_t </b><br/>这是一个适合存储处理器时间的类型。</td></tr>&#13;
<tr><td>3</td><td><b>time_t is </b><br/>这是一个适合存储日历时间的类型。</td></tr>&#13;
<tr><td>4</td><td><b>struct tm </b><br/>这是一个用来保存时间和日期的结构。</td></tr>&#13;
</table>&#13;
<p>tm 结构的定义如下：</p>&#13;
<pre>&#13;
struct tm {&#13;
   int tm_sec;         /* 秒，范围从 0 到 59        */&#13;
   int tm_min;         /* 分，范围从 0 到 59        */&#13;
   int tm_hour;        /* 小时，范围从 0 到 23        */&#13;
   int tm_mday;        /* 一月中的第几天，范围从 1 到 31    */&#13;
   int tm_mon;         /* 月，范围从 0 到 11        */&#13;
   int tm_year;        /* 自 1900 年起的年数        */&#13;
   int tm_wday;        /* 一周中的第几天，范围从 0 到 6    */&#13;
   int tm_yday;        /* 一年中的第几天，范围从 0 到 365    */&#13;
   int tm_isdst;       /* 夏令时                */&#13;
};&#13;
</pre>&#13;
&#13;
<h2>库宏</h2>&#13;
<p>下面是头文件 time.h 中定义的宏：</p>&#13;
<table class="reference notranslate">&#13;
<tr><th style="width:5%">序号</th><th>宏 &amp; 描述</th></tr>&#13;
<tr><td>1</td><td><b>NULL</b><br/>这个宏是一个空指针常量的值。</td></tr>&#13;
<tr><td>2</td><td><b>CLOCKS_PER_SEC </b><br/>这个宏表示每秒的处理器时钟个数。</td></tr>&#13;
</table>&#13;
&#13;
<h2>库函数</h2>&#13;
<p>下面是头文件 time.h 中定义的函数：</p>&#13;
<table class="reference notranslate">&#13;
<tr><th style="width:5%">序号</th><th>函数 &amp; 描述</th></tr>&#13;
<tr><td>1</td><td><a href="c-function-asctime.html">char *asctime(const struct tm *timeptr)</a><br/>返回一个指向字符串的指针，它代表了结构 timeptr 的日期和时间。</td></tr>&#13;
<tr><td>2</td><td><a href="c-function-clock.html">clock_t clock(void)</a><br/>返回程序执行起（一般为程序的开头），处理器时钟所使用的时间。</td></tr>&#13;
<tr><td>3</td><td><a href="c-function-ctime.html">char *ctime(const time_t *timer)</a><br/>返回一个表示当地时间的字符串，当地时间是基于参数 timer。</td></tr>&#13;
<tr><td>4</td><td><a href="c-function-difftime.html">double difftime(time_t time1, time_t time2)</a><br/>返回 time1 和 time2 之间相差的秒数 (time1-time2)。</td></tr>&#13;
<tr><td>5</td><td><a href="c-function-gmtime.html">struct tm *gmtime(const time_t *timer)</a><br/>timer 的值被分解为 tm 结构，并用协调世界时（UTC）也被称为格林尼治标准时间（GMT）表示。</td></tr>&#13;
<tr><td>6</td><td><a href="c-function-localtime.html">struct tm *localtime(const time_t *timer)</a><br/>timer 的值被分解为 tm 结构，并用本地时区表示。</td></tr>&#13;
<tr><td>7</td><td><a href="c-function-mktime.html">time_t mktime(struct tm *timeptr)</a><br/>把 timeptr 所指向的结构转换为一个依据本地时区的 time_t 值。</td></tr>&#13;
<tr><td>8</td><td><a href="c-function-strftime.html">size_t strftime(char *str, size_t maxsize, const char *format, const struct tm *timeptr)</a><br/>根据 format 中定义的格式化规则，格式化结构 timeptr 表示的时间，并把它存储在 str 中。</td></tr>&#13;
<tr><td>9</td><td><a href="c-function-time.html">time_t time(time_t *timer)</a><br/>计算当前日历时间，并把它编码成 time_t 格式。</td></tr>&#13;
&#13;
<tr><td>10</td><td><a href="c-function-timespec_get.html">int timespec_get(struct timespec *ts, int base);</a><br/>获取当前时间（C11）。</td></tr>&#13;
</table>&#13;
<h3>实例</h3>&#13;
<p>以下是使用 <code>&lt;time.h&gt;</code> 中一些函数的示例。</p>&#13;
<p>&#13;
获取当前时间：</p>&#13;
<div class="example"><h2 class="example">实例</h2> <div class="example_code">
<span style="color: #085;">#include &lt;stdio.h&gt;</span><br/>
<span style="color: #085;">#include &lt;time.h&gt;</span><br/>
<br/>
<span style="color: #993333;">int</span> main<span style="color: #000;">(</span><span style="color: #000;">)</span> <span style="color: #000;">{</span><br/>
    time_t current_time<span style="color: #339933;">;</span><br/>
    <span style="color: #000066;">time</span><span style="color: #000;">(</span><span style="color: #339933;">&amp;</span>current_time<span style="color: #000;">)</span><span style="color: #339933;">;</span><br/>
    <span style="color: #000066;">printf</span><span style="color: #000;">(</span><span style="color: #a11;">"Current time: %s"</span><span style="color: #339933;">,</span> <span style="color: #000066;">ctime</span><span style="color: #000;">(</span><span style="color: #339933;">&amp;</span>current_time<span style="color: #000;">)</span><span style="color: #000;">)</span><span style="color: #339933;">;</span><br/>
<br/>
    <span style="color: #708;">return</span> <span style="color: #164;">0</span><span style="color: #339933;">;</span><br/>
<span style="color: #000;">}</span><br/>
</div></div><p>&#13;
格式化时间:</p>&#13;
&#13;
<div class="example"><h2 class="example">实例</h2> <div class="example_code">
<span style="color: #085;">#include &lt;stdio.h&gt;</span><br/>
<span style="color: #085;">#include &lt;time.h&gt;</span><br/>
<br/>
<span style="color: #993333;">int</span> main<span style="color: #000;">(</span><span style="color: #000;">)</span> <span style="color: #000;">{</span><br/>
    time_t current_time<span style="color: #339933;">;</span><br/>
    <span style="color: #993333;">struct</span> tm <span style="color: #339933;">*</span>time_info<span style="color: #339933;">;</span><br/>
    <span style="color: #993333;">char</span> buffer<span style="color: #000;">[</span><span style="color: #164;">80</span><span style="color: #000;">]</span><span style="color: #339933;">;</span><br/>
<br/>
    <span style="color: #000066;">time</span><span style="color: #000;">(</span><span style="color: #339933;">&amp;</span>current_time<span style="color: #000;">)</span><span style="color: #339933;">;</span><br/>
    time_info <span style="color: #339933;">=</span> <span style="color: #000066;">localtime</span><span style="color: #000;">(</span><span style="color: #339933;">&amp;</span>current_time<span style="color: #000;">)</span><span style="color: #339933;">;</span><br/>
<br/>
    <span style="color: #000066;">strftime</span><span style="color: #000;">(</span>buffer<span style="color: #339933;">,</span> <span style="color: #993333;">sizeof</span><span style="color: #000;">(</span>buffer<span style="color: #000;">)</span><span style="color: #339933;">,</span> <span style="color: #a11;">"%Y-%m-%d %H:%M:%S"</span><span style="color: #339933;">,</span> time_info<span style="color: #000;">)</span><span style="color: #339933;">;</span><br/>
    <span style="color: #000066;">printf</span><span style="color: #000;">(</span><span style="color: #a11;">"Formatted time: %s<span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #339933;">,</span> buffer<span style="color: #000;">)</span><span style="color: #339933;">;</span><br/>
<br/>
    <span style="color: #708;">return</span> <span style="color: #164;">0</span><span style="color: #339933;">;</span><br/>
<span style="color: #000;">}</span><br/>
</div></div>&#13;
<p>计算时间差: </p>&#13;
<div class="example"><h2 class="example">实例</h2> <div class="example_code">
<span style="color: #085;">#include &lt;stdio.h&gt;</span><br/>
<span style="color: #085;">#include &lt;time.h&gt;</span><br/>
<br/>
<span style="color: #993333;">int</span> main<span style="color: #000;">(</span><span style="color: #000;">)</span> <span style="color: #000;">{</span><br/>
    time_t start_time<span style="color: #339933;">,</span> end_time<span style="color: #339933;">;</span><br/>
    <span style="color: #993333;">double</span> time_diff<span style="color: #339933;">;</span><br/>
<br/>
    <span style="color: #000066;">time</span><span style="color: #000;">(</span><span style="color: #339933;">&amp;</span>start_time<span style="color: #000;">)</span><span style="color: #339933;">;</span><br/>
    <span style="color: #666666; font-style: italic;">// 模拟一个耗时操作</span><br/>
    <span style="color: #708;">for</span> <span style="color: #000;">(</span><span style="color: #993333;">int</span> i <span style="color: #339933;">=</span> <span style="color: #164;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> <span style="color: #164;">100000000</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #000;">)</span><span style="color: #339933;">;</span><br/>
<br/>
    <span style="color: #000066;">time</span><span style="color: #000;">(</span><span style="color: #339933;">&amp;</span>end_time<span style="color: #000;">)</span><span style="color: #339933;">;</span><br/>
    time_diff <span style="color: #339933;">=</span> <span style="color: #000066;">difftime</span><span style="color: #000;">(</span>end_time<span style="color: #339933;">,</span> start_time<span style="color: #000;">)</span><span style="color: #339933;">;</span><br/>
    <span style="color: #000066;">printf</span><span style="color: #000;">(</span><span style="color: #a11;">"Time difference: %.2f seconds<span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #339933;">,</span> time_diff<span style="color: #000;">)</span><span style="color: #339933;">;</span><br/>
<br/>
    <span style="color: #708;">return</span> <span style="color: #164;">0</span><span style="color: #339933;">;</span><br/>
<span style="color: #000;">}</span><br/>
</div></div>&#13;
<p>使用 <span class="marked">struct tm</span>:</p>&#13;
&#13;
<div class="example"><h2 class="example">实例</h2> <div class="example_code">
<span style="color: #085;">#include &lt;stdio.h&gt;</span><br/>
<span style="color: #085;">#include &lt;time.h&gt;</span><br/>
<br/>
<span style="color: #993333;">int</span> main<span style="color: #000;">(</span><span style="color: #000;">)</span> <span style="color: #000;">{</span><br/>
    <span style="color: #993333;">struct</span> tm time_info<span style="color: #339933;">;</span><br/>
    <span style="color: #993333;">char</span> buffer<span style="color: #000;">[</span><span style="color: #164;">80</span><span style="color: #000;">]</span><span style="color: #339933;">;</span><br/>
<br/>
    time_info.<span style="color: #202020;">tm_year</span> <span style="color: #339933;">=</span> <span style="color: #164;">2024</span> <span style="color: #339933;">-</span> <span style="color: #164;">1900</span><span style="color: #339933;">;</span>  <span style="color: #666666; font-style: italic;">// 年份从 1900 年开始计算</span><br/>
    time_info.<span style="color: #202020;">tm_mon</span> <span style="color: #339933;">=</span> <span style="color: #164;">5</span><span style="color: #339933;">;</span>             <span style="color: #666666; font-style: italic;">// 六月，范围从 0 到 11</span><br/>
    time_info.<span style="color: #202020;">tm_mday</span> <span style="color: #339933;">=</span> <span style="color: #164;">12</span><span style="color: #339933;">;</span><br/>
    time_info.<span style="color: #202020;">tm_hour</span> <span style="color: #339933;">=</span> <span style="color: #164;">12</span><span style="color: #339933;">;</span><br/>
    time_info.<span style="color: #202020;">tm_min</span> <span style="color: #339933;">=</span> <span style="color: #164;">0</span><span style="color: #339933;">;</span><br/>
    time_info.<span style="color: #202020;">tm_sec</span> <span style="color: #339933;">=</span> <span style="color: #164;">0</span><span style="color: #339933;">;</span><br/>
    time_info.<span style="color: #202020;">tm_isdst</span> <span style="color: #339933;">=</span> <span style="color: #339933;">-</span><span style="color: #164;">1</span><span style="color: #339933;">;</span>          <span style="color: #666666; font-style: italic;">// 自动判断是否为夏令时</span><br/>
<br/>
    <span style="color: #000066;">mktime</span><span style="color: #000;">(</span><span style="color: #339933;">&amp;</span>time_info<span style="color: #000;">)</span><span style="color: #339933;">;</span><br/>
<br/>
    <span style="color: #000066;">strftime</span><span style="color: #000;">(</span>buffer<span style="color: #339933;">,</span> <span style="color: #993333;">sizeof</span><span style="color: #000;">(</span>buffer<span style="color: #000;">)</span><span style="color: #339933;">,</span> <span style="color: #a11;">"%Y-%m-%d %H:%M:%S"</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>time_info<span style="color: #000;">)</span><span style="color: #339933;">;</span><br/>
    <span style="color: #000066;">printf</span><span style="color: #000;">(</span><span style="color: #a11;">"Custom time: %s<span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #339933;">,</span> buffer<span style="color: #000;">)</span><span style="color: #339933;">;</span><br/>
<br/>
    <span style="color: #708;">return</span> <span style="color: #164;">0</span><span style="color: #339933;">;</span><br/>
<span style="color: #000;">}</span><br/>
</div></div><h3>注意事项</h3><ul><li>使用 <code>localtime</code> 和 <code>gmtime</code> 时，返回的指针指向的 <code>struct tm</code> 结构是静态存储的，每次调用会覆盖之前的内容。</li><li>使用 <code>mktime</code> 函数时，必须确保 <code>struct tm</code> 中的各个字段是合法的。</li><li>使用 <code>strftime</code> 函数进行时间格式化时，要确保目标缓冲区足够大，以避免缓冲区溢出。</li></ul><p>通过理解和使用 <code>&lt;time.h&gt;</code> 提供的函数，可以方便地进行时间和日期的操作，从而编写更加功能丰富和高效的 C 程序。</p>			<!-- 其他扩展 -->
						
			</div>
			
		
</body>
</html>